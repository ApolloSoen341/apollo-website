var comp232 = [
                //{"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"DD","type":"LEC","day":"We","timeBegin":"5:45PM","timeEnd":"8:15PM","room":"H 920 SGW","semester":"Fall 2016","classid":1808}
                //,
                //{"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"DDDA","type":"TUT","day":"We","timeBegin":"8:30PM","timeEnd":"10:10PM","room":"MB S1.105 SGW","semester":"Fall 2016","classid":1807}
                //,
                //{"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"DDDB","type":"TUT","day":"We","timeBegin":"8:30PM","timeEnd":"10:10PM","room":"MB S1.255 SGW","semester":"Fall 2016","classid":1806}
                //,
                //{"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"PP","type":"LEC","day":"Th","timeBegin":"5:45PM","timeEnd":"8:15PM","room":"H 1070 SGW","semester":"Fall 2016","classid":8648}
                //,
                //{"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"PPPA","type":"TUT","day":"Th","timeBegin":"8:30PM","timeEnd":"10:10PM","room":"MB 2.265 SGW","semester":"Fall 2016","classid":8649}
                //,
                //{"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"PPPB","type":"TUT","day":"Th","timeBegin":"8:30PM","timeEnd":"10:10PM","room":"MB S1.105 SGW","semester":"Fall 2016","classid":8650}
                //,
                //{"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"PPPC","type":"TUT","day":"Th","timeBegin":"8:30PM","timeEnd":"10:10PM","room":"MB S2.105 SGW","semester":"Fall 2016","classid":8651}
                //,
                //{"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"Q","type":"LEC","day":"TuTh","timeBegin":"1:15PM","timeEnd":"2:30PM","room":"H 520 SGW","semester":"Fall 2016","classid":1805}
                //,
                //{"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"Q QA","type":"TUT","day":"Tu","timeBegin":"4:15PM","timeEnd":"5:55PM","room":"MB 2.285 SGW","semester":"Fall 2016","classid":1803}
                //,
                //{"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"Q QC","type":"TUT","day":"Th","timeBegin":"2:45PM","timeEnd":"4:25PM","room":"MB S1.255 SGW","semester":"Fall 2016","classid":8201}
                //,
                //{"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"Q QB","type":"TUT","day":"Th","timeBegin":"2:45PM","timeEnd":"4:25PM","room":"MB S1.105 SGW","semester":"Fall 2016","classid":1804}
                //,
                {"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"R","type":"LEC","day":"TuTh","timeBegin":"1:15PM","timeEnd":"2:30PM","room":"H 820 SGW","semester":"Fall 2016","classid":1802}
                ,
                {"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"R RA","type":"TUT","day":"Tu","timeBegin":"4:15PM","timeEnd":"5:55PM","room":"MB 1.301 SGW","semester":"Fall 2016","classid":1801}
                ,
                {"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"R RB","type":"TUT","day":"Tu","timeBegin":"4:15PM","timeEnd":"5:55PM","room":"MB 2.255 SGW","semester":"Fall 2016","classid":1800}
                ,
                {"faculty":"COMP","classNum":"232","title":"Mathematics for Computer Science ","section":"R RC","type":"TUT","day":"Tu","timeBegin":"4:15PM","timeEnd":"5:55PM","room":"MB 2.265 SGW","semester":"Fall 2016","classid":8202}
                ];

var comp249 = [
                {"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"D","type":"LEC","day":"MoWe","timeBegin":"2:45PM","timeEnd":"4:00PM","room":"H 420 SGW","semester":"Fall 2016","classid":7469}
                ,
                {"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"D DA","type":"TUT","day":"Mo","timeBegin":"12:45PM","timeEnd":"2:35PM","room":"TBA","semester":"Fall 2016","classid":7470}
                ,
                {"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"D DB","type":"TUT","day":"We","timeBegin":"4:15PM","timeEnd":"5:55PM","room":"TBA","semester":"Fall 2016","classid":7471}
                ,
                {"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"D DC","type":"TUT","day":"Mo","timeBegin":"4:15PM","timeEnd":"5:55PM","room":"TBA","semester":"Fall 2016","classid":7472}
                ,
                {"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"DI","type":"X","day":"Mo","timeBegin":"6:15PM","timeEnd":"7:15PM","room":"TBA","semester":"Fall 2016","classid":7473}
                ,
                {"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"DJ","type":"X","day":"We","timeBegin":"6:15PM","timeEnd":"7:15PM","room":"TBA","semester":"Fall 2016","classid":7474}
                ,
                {"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"DK","type":"X","day":"We","timeBegin":"7:30PM","timeEnd":"8:30PM","room":"TBA","semester":"Fall 2016","classid":7475}
                //,
                //{"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"E","type":"LEC","day":"MoWe","timeBegin":"2:45PM","timeEnd":"4:00PM","room":"H 1070 SGW","semester":"Fall 2016","classid":8707}
                //,
                //{"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"E EA","type":"TUT","day":"Mo","timeBegin":"12:45PM","timeEnd":"2:35PM","room":"TBA","semester":"Fall 2016","classid":8708}
                //,
                //{"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"E EB","type":"TUT","day":"We","timeBegin":"4:15PM","timeEnd":"5:55PM","room":"TBA","semester":"Fall 2016","classid":8709}
                //,
                //{"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"E EC","type":"TUT","day":"Mo","timeBegin":"4:15PM","timeEnd":"5:55PM","room":"TBA","semester":"Fall 2016","classid":8710}
                //,
                //{"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"EI","type":"X","day":"Mo","timeBegin":"6:15PM","timeEnd":"7:15PM","room":"TBA","semester":"Fall 2016","classid":8711}
                //,
                //{"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"EJ","type":"X","day":"We","timeBegin":"6:15PM","timeEnd":"7:15PM","room":"TBA","semester":"Fall 2016","classid":8712}
                //,
                //{"faculty":"COMP","classNum":"249","title":"Object-Oriented Programming II ","section":"EK","type":"X","day":"We","timeBegin":"7:30PM","timeEnd":"8:30PM","room":"TBA","semester":"Fall 2016","classid":8713}
                ];


var selectedCourses = [comp232,comp249];
var combos = getSchedules(selectedCourses);

console.log(combos);

function getSchedules(selectedCourses) {
    var groupedCourses = [];
    for (var i=0; i<selectedCourses.length; i++) {
        var course = getSectionCombinations(selectedCourses[i]);
        var grouped = groupCombinations(course);
        groupedCourses.push(grouped);
    }

    return getCourseCombinations(groupedCourses);
}


var courseCombinations = getSectionCombinations(comp249);

function getSectionCombinations(selectedCourse) {
    var combinations = [];
    var lecs = [];
    var tuts = [];
    var labs = [];


    // group sections by type
    for (var i=0; i<selectedCourse.length; i++) {
        if(selectedCourse[i].type == "LEC") {
            var lec = {};
            lec.section = selectedCourse[i].section;
            lec.timeBegin = selectedCourse[i].timeBegin;
            lec.timeEnd = selectedCourse[i].timeEnd;
            lec.day = selectedCourse[i].day;
            lecs.push(lec);
        } else if(selectedCourse[i].type == "TUT") {
            var tut = {};
            tut.section = selectedCourse[i].section;
            tut.timeBegin = selectedCourse[i].timeBegin;
            tut.timeEnd = selectedCourse[i].timeEnd;
            tut.day = selectedCourse[i].day;
            tuts.push(tut);
        } else {
            var lab = {};
            lab.section = selectedCourse[i].section;
            lab.timeBegin = selectedCourse[i].timeBegin;
            lab.timeEnd = selectedCourse[i].timeEnd;
            lab.day = selectedCourse[i].day;
            labs.push(lab);
        }
    }

    for (var i=0; i<lecs.length; i++) {
        if (tuts.length <= 0) {
            var course = {};
            course.lec = lecs[i];
            combinations.push(course);
        }
        for (var j=0; j<tuts.length; j++) {
            if (tuts[j].section.charAt(0) == lecs[i].section.charAt(0)) {
                if (labs.length <= 0) {
                    var course = {};
                    course.lec = lecs[i];
                    course.tut  = tuts[j];
                    combinations.push(course);
                } else {
                    for (var k=0; k<labs.length; k++) {
                        if (labs[k].section.charAt(0) == lecs[i].section.charAt(0)) {
                            var course = {};
                            course.lec = lecs[i];
                            course.tut = tuts[j];
                            course.lab = labs[k];
                            combinations.push(course);
                        }
                    }
                }
            }
        }
    }
    return combinations;
}

//console.log(courseCombinations);


///////////////////////////////////////////////////

var groupSections =  groupCombinations(courseCombinations);

/**
 * groupCombinations returns array of sections grouped by same time and day
 * Example of a groupedSection: "D - D DA - DI or E - E EA - EI or E - E EA - EJ"
 * @param courseCombinations
 * @returns {Array}
 */

function groupCombinations(courseCombinations){
    var temp = courseCombinations;
    var groupedSections = [];
    var removeGroups = [];
    var hasTutorials = (temp[0] && temp[0].tut != null);
    var hasLabs = (temp[0] && temp[0].lab != null);

    //groupedSectionsIndex
    var x = 0;

    //Iterate through the combinations and group them
    while(temp.length !=0){

        var group = {};
        var removeGroup = [];
        var hasGroupSections = false;

        for (var i=1; i<temp.length; i++){
            var lec = {};
            var tut = {};
            var lab = {};

            //To accomodate if a course does not have a lab or tut,
            //these variables are first initialized to true:
            var hasSameLecTime = true;
            var hasSameTutTime = true;
            var hasSameLabTime = true;

            //Check lecture times
            //Check tutorial times if course has tutorials
            //Check lab times if course has labs
            var hasSameLecTime = (temp[0].lec.timeBegin == temp[i].lec.timeBegin) && (temp[0].lec.timeEnd == temp[i].lec.timeEnd) && (temp[0].lec.day == temp[i].lec.day);
            if(hasTutorials){
                hasSameTutTime = (temp[0].tut.timeBegin == temp[i].tut.timeBegin) && (temp[0].tut.timeEnd == temp[i].tut.timeEnd) && (temp[0].tut.day == temp[i].tut.day);
            }
            if(hasLabs){
                hasSameLabTime = (temp[0].lab.timeBegin == temp[i].lab.timeBegin) && (temp[0].lab.timeEnd == temp[i].lab.timeEnd) && (temp[0].lab.day == temp[i].lab.day);
            }

            //Add courses with matching times to groupedSections
            if (hasSameLecTime && hasSameTutTime && hasSameLabTime){
                hasGroupSections = true;

                //Add the first matching pair to groupedSections
                if(groupedSections[x] == null){

                    //Get section titles
                    if(hasTutorials && hasLabs){
                        var sectionA = temp[0].lec.section + "-" + temp[0].tut.section + "-" + temp[0].lab.section;
                        var sectionB = temp[i].lec.section + "-" + temp[i].tut.section + "-" + temp[i].lab.section;
                        group.name = sectionA + " or " + sectionB;
                    } else if(hasTutorials) {
                        var sectionA = temp[0].lec.section + "-" + temp[0].tut.section;
                        var sectionB = temp[i].lec.section + "-" + temp[i].tut.section;
                        group.name = sectionA + " or " + sectionB;
                    } else if(hasLabs){
                        var sectionA = temp[0].lec.section + "-" + temp[0].lab.section;
                        var sectionB = temp[i].lec.section + "-" + temp[i].lab.section;
                        group.name = sectionA + " or " + sectionB;
                    } else {
                        var sectionA = temp[0].lec.section;
                        var sectionB = temp[i].lec.section;
                        group.name = sectionA + " or " + sectionB;
                    }

                    //Get lec time
                    lec.timeBegin = temp[0].lec.timeBegin;
                    lec.timeEnd = temp[0].lec.timeEnd;
                    lec.day = temp[0].lec.day;
                    group.lec = lec;


                    //Get tut time
                    if(hasTutorials){
                        tut.timeBegin = temp[0].tut.timeBegin;
                        tut.timeEnd = temp[0].tut.timeEnd;
                        tut.day = temp[0].tut.day;
                        group.tut = tut;
                    }

                    //Get lab time
                    if(hasLabs){
                        lab.timeBegin = temp[0].lab.timeBegin;
                        lab.timeEnd = temp[0].lab.timeEnd;
                        lab.day = temp[0].lab.day;
                        group.lab = lab;
                    }

                    //Save indices to remove
                    removeGroup.push(0);
                    removeGroup.push(i)

                    groupedSections.push(group);

                } else {
                    //Add another section to a group in groupedSections

                    //Get section titles
                    if(hasTutorials && hasLabs){
                        var sectionB = temp[i].lec.section + "-" + temp[i].tut.section + "-" + temp[i].lab.section;
                        groupedSections[x].name = groupedSections[x].name + " or " + sectionB;
                    } else if(hasTutorials){
                        var sectionB = temp[i].lec.section + "-" + temp[i].tut.section;
                        groupedSections[x].name = groupedSections[x].name + " or " + sectionB;
                    } else if(hasLabs){
                        var sectionB = temp[i].lec.section + "-" + temp[i].lab.section;
                        groupedSections[x].name = groupedSections[x].name + " or " + sectionB;
                    } else {
                        var sectionB = temp[i].lec.section;
                        groupedSections[x].name = groupedSections[x].name + " or " + sectionB;
                    }

                    //Save index to remove
                    removeGroup.push(i);

                }
            }


        }

        if(!hasGroupSections) {
            //If none have same times with the a section,
            //then push the single section

            //Get section title
            if(hasTutorials && hasLabs){
                group.name = temp[0].lec.section + "-" + temp[0].tut.section + "-" + temp[0].lab.section;
            } else if(hasTutorials){
                group.name = temp[0].lec.section + "-" + temp[0].tut.section;
            } else if(hasLabs){
                group.name = temp[0].lec.section + "-" + temp[0].lab.section;
            } else {
                group.name = temp[0].lec.section;
            }

            //Get lec time
            lec.timeBegin = temp[0].lec.timeBegin;
            lec.timeEnd = temp[0].lec.timeEnd;
            lec.day = temp[0].lec.day;
            group.lec = lec;

            //Get tut time
            if(hasTutorials){
                tut.timeBegin = temp[0].tut.timeBegin;
                tut.timeEnd = temp[0].tut.timeEnd;
                tut.day = temp[0].tut.day;
                group.tut = tut;
            }

            //Get lab time
            if(hasLabs){
                lab.timeBegin = temp[0].lab.timeBegin;
                lab.timeEnd = temp[0].lab.timeEnd;
                lab.day = temp[0].lab.day;
                group.lab = lab;
            }

            //Save indices to remove
            removeGroup.push(0);

            groupedSections.push(group);
        }

        //Remove all indices in temp that were pushed to groupedSections
        for(var i= (removeGroup.length - 1); i>=0; i--){
            var location = removeGroup[i];
            temp.splice(location, 1);
        }


        //Increment groupedSections tail index
        x++;

    }

    return groupedSections;

}


//console.log(groupSections);

///////////////////////////////////////////////////


var timeA = "8:45AM";
var timeB = "1:00PM";
var test = convertTimeFormat(timeB);

/**
 * convertTimeFormat converts AMPM time to 24H time
 * @param t
 * @returns {number}
 */
function convertTimeFormat(t) {
    //Get time digits and convert to integer number
    var timeMatch = t.match(/\d+/g);
    var timeStr = "";
    for(var i=0; i<timeMatch.length; i++){
        timeStr = timeStr + timeMatch[i];
    }
    var timeInt = Number(timeStr);

    //Get AMPM and convert to string
    var AMPMMatch = t.match(/(AM|PM)$/g);
    var AMPMStr = AMPMMatch[0];

    //Convert to 24H range
    if (AMPMStr == "PM" && timeInt < 1200){
        timeInt = timeInt + 1200;
    }
    if (AMPMStr == "AM" && timeInt == 1200){
        timeInt = timeInt - 1200;
    }
    return timeInt;

}

//console.log(test);


///////////////////////////////////////////////////

/**
 * Cartesian Product recursive algorithm
 * returns conflict-free course combinations
 */
function getCourseCombinations(selectedCourses) {
    var firstCourse, combination = [];

    //base case
    if (!selectedCourses || selectedCourses.length == 0) {
        return selectedCourses;
    }

    //recursive case
    firstCourse = selectedCourses.splice(0,1)[0];
    selectedCourses = getCourseCombinations(selectedCourses);

    for (var i=0; i<firstCourse.length; i++) {
        if (selectedCourses && selectedCourses.length > 0) {
            for (var j=0; j<selectedCourses.length; j++) {
                var add = true;
                for (var k=0; k<selectedCourses[j].length; k++) {
                    if (isConflict(firstCourse[i].lec, selectedCourses[j][k].lec) ||
                        selectedCourses[j][k].tut && isConflict(firstCourse[i].lec, selectedCourses[j][k].tut) ||
                        selectedCourses[j][k].lab && isConflict(firstCourse[i].lec, selectedCourses[j][k].lab)) {
                        add = false;
                        break;
                    }
                    if (firstCourse[i].tut) {
                        if (isConflict(firstCourse[i].tut, selectedCourses[j][k].lec) ||
                            selectedCourses[j][k].tut && isConflict(firstCourse[i].tut, selectedCourses[j][k].tut) ||
                            selectedCourses[j][k].lab && isConflict(firstCourse[i].tut, selectedCourses[j][k].lab)) {
                            add = false;
                            break;
                        }
                    }
                    if (firstCourse[i].lab) {
                        if (isConflict(firstCourse[i].lab, selectedCourses[j][k].lec) ||
                            selectedCourses[j][k].tut && isConflict(firstCourse[i].lab, selectedCourses[j][k].tut) ||
                            selectedCourses[j][k].lab && isConflict(firstCourse[i].lab, selectedCourses[j][k].lab)) {
                            add = false;
                            break;
                        }
                    }
                }
                if (add) {
                    combination.push([firstCourse[i]].concat(selectedCourses[j]));
                }
            }
        }
        else {
            combination.push(firstCourse[i]);
        }
    }

    return combination;
}

function isConflict(block1, block2) {
    var begin1 = convertTimeFormat(block1.timeBegin);
    var begin2 = convertTimeFormat(block1.timeEnd);
    var end1 = convertTimeFormat(block2.timeBegin);
    var end2 = convertTimeFormat(block2.timeEnd);
    if ((block1.day.indexOf(block2.day) > -1) || (block2.day.indexOf(block1.day) > -1)) {
        if ((begin1 >= begin2 && begin1 < end2) || (end1 > begin2 && end1 <= end2)) {
            return true;
        }
    }
    return false;
}




